/*******************************************************************
********************************************************************
********....................................................********
*******...........//M\\.......//M\\.........|||PPPPP\\.......*******
******...........///.\\\.....///.\\\........|||.....))).......******
*****...........///...\\\...///...\\\.......|||PPPPP//.........*****
******.........///.....\\\.///.....\\\......|||...............******
*******.......///.......\\V//.......\\\.O...|||.....O........*******
********....................................................********
********************************************************************
********************************************************************
****************  ________________________________  ****************
****************  |                              |  ****************
****************  | File:    si7020.c            |  ****************
****************  |______________________________|  ****************
****************  |                              |  ****************
****************  | Version: 1.0                 |  ****************
****************  | Date:    01.02.2018          |  ****************
****************  | Author:  Martin PannenbÃ¤cker |  ****************
****************  |______________________________|  ****************
****************                                    ****************
********************************************************************
********************************************************************
*******************************************************************/

     /**************************************************************************************************************************************
    ///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
   ///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
  //////////////////////////////////////////////////// Includes /////////////////////////////////////////////////////////////////////////
 ///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
*************************************************************************************************************************************/

#include "si7020.h"


     /**************************************************************************************************************************************
    ///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
   ///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
  /////////////////////////////////////////////////// Functions /////////////////////////////////////////////////////////////////////////
 ///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
*************************************************************************************************************************************/

  ///////////////////////////////////////////////
 //////////// Read Si7020 Temp /////////////////
///////////////////////////////////////////////
int16_t si7020_getTemp()
{
    float temp = ((I2C_read16b(SI7020_TEMPMEAS)/3.73)-4685);
    return (int16_t) temp;
}


  ///////////////////////////////////////////////
 //////////// Read Si7020 Hum //////////////////
///////////////////////////////////////////////
uint8_t si7020_getHum()
{
    return (uint8_t) ((I2C_read16b(SI7020_HUMMEAS)>>9)-6);
}


  ///////////////////////////////////////////////
 ////////////// Heat Si7020 ////////////////////
///////////////////////////////////////////////
void si7020_heat(uint8_t current, uint32_t ms)
{
    I2C_writeByte(SI7020_HEATERCTRL, current);
    delay_ms(100);
    I2C_writeByte(SI7020_USERREG1, SI7020_HEATER_EN);
    delay_ms(ms);
    I2C_writeByte(SI7020_USERREG1, SI7020_HEATER_DIS);
}
